{% extends 'site_base.html' %}
{% load static %}
{# base template for displaying a network graph #}
{# main blocks to extend: pregraph-content, postgraph-content, json-url #}

{% block css %}
  {{ block.super }}
  <link href="{% static Rena'network/css/sigma.css' %}" rel="stylesheet"/>
{% endblock %}


{% block javascript %}
    {{ block.super }}
    <script src="{% static 'js/sigma/sigma.min.js' %}"></script>
    <script src="{% static 'js/sigma/plugins/sigma.parsers.json.min.js' %}"></script>
    <script src="{% static 'js/sigma/plugins/sigma.layout.forceAtlas2.min.js' %}"></script>
    {# additional plugins still TBD #}
    {#<script src="{% static 'js/sigma/plugins/sigma.plugins.relativeSize.min.js' %}"></script> #}
    {#<script src="{% static 'js/sigma/plugins/sigma.renderers.edgeLabels.min.js' %}"></script> #}
{% endblock %}


{% block content %}

{% block pregraph-content %}{% endblock %}

<div id="sigma-container">
  <div id="graph-container"></div>
</div>

{% block postgraph-content %}{% endblock %}

<script>
// Instantiate sigma with an empty graph
s = new sigma({
  renderer: {
    container: document.getElementById('graph-container'),
    type: 'canvas'
  }
});

// load graph data via json
sigma.parsers.json("{% block json-url %}{% endblock %}",
  s,
  function() {
    // init nodes with random placement
    $.each(s.graph.nodes(), function(i, node) {
      node.x = Math.random();
      node.y = Math.random();
      node.size = 1;
      node.color = '#666';
    });
    // set curved edges
    $.each(s.graph.edges(), function(i, edge) {
      edge.type = 'curve';
    });
    console.log(s.graph.edges());

    // adjust node size by degree
    // sigma.plugins.relativeSize(s, 1);
    // NOTE: this works, but ends up with nearly all the nodes
    // being unlabeled because they are so small
    // leaving disabled for now

    // update the graph with the added nodes + edges
    s.refresh();
    // run force atlas layout
    s.startForceAtlas2({worker: true, barnesHutOptimize: false});
    window.setTimeout(function() {
      s.stopForceAtlas2();
    }, 500);
  }
);

</script>

{% endblock %}