(function(undefined){"use strict";function deepCopy(o){var copy=Object.create(null);for(var i in o)"object"==typeof o[i]&&null!==o[i]?copy[i]=deepCopy(o[i]):"function"==typeof o[i]&&null!==o[i]?eval(" copy[i] = "+o[i].toString()):copy[i]=o[i];return copy}function cloneChain(e){for(var n=e.slice(0),r=0,i=n.length;i>r;r++)n[r]=deepCopy(n[r]);return n}function strToObjectRef(e,n){return n.split(".").reduce(function(e,n){return e[n]},e)}function Filter(s){function register(e,n,r,i){if(arguments[3]===undefined&&"object"!=typeof arguments[2]&&(i=r,r=null),i!==undefined&&"number"!=typeof i&&"string"!=typeof i)throw new TypeError('Invalid argument: "key" is not a number or a string, was '+i);if(i!==undefined&&"string"==typeof i&&!i.length)throw new TypeError('Invalid argument: "key" is an empty string.');if("string"!=typeof e)throw new TypeError('Invalid argument: "processor" is not a string, was '+e);if("undo"===i)throw new Error('Invalid argument: "key" has value "undo", which is a reserved keyword.');if(_keysIndex[i])throw new Error('Invalid argument: the filter of key "'+i+'" already exists.');i&&(_keysIndex[i]=!0),_chain.push({key:i,processor:e,predicate:n,options:r||{}})}function unregister(e){_chain=_chain.filter(function(n){return!(n.key in e)});for(var n in e)delete _keysIndex[n]}var _self=this,_s=s,_g=s.graph,_chain=[],_keysIndex=Object.create(null);this.has=function(e){return _keysIndex[e]},this.nodesBy=function(e,n,r){return register("nodes",e,n,r),this},this.edgesBy=function(e,n,r){return register("edges",e,n,r),this},this.neighborsOf=function(e,n,r){if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("Invalid argument: id is not a string or a number, was "+e);if("string"==typeof e&&!e.length)throw new TypeError("Invalid argument: id is an empty string.");return register("neighbors",e,n,r),this},this.apply=function(){for(var e=0,n=_chain.length;n>e;++e)switch(_chain[e].processor){case"nodes":Processors.nodes(_g,_chain[e].predicate,_chain[e].options);break;case"edges":Processors.edges(_g,_chain[e].predicate,_chain[e].options);break;case"neighbors":Processors.neighbors(_g,_chain[e].predicate);break;case"undo":Processors.undo(_g,_chain[e].predicate);break;default:throw new Error("Unknown processor "+_chain[e].processor)}return _chain[0]&&"undo"===_chain[0].key&&_chain.shift(),_s&&_s.refresh(),this},this.undo=function(e){var n=Object.create(null),r=arguments.length;if(1===r)if("[object Array]"===Object.prototype.toString.call(e))for(var i=0,t=e.length;t>i;i++)n[e[i]]=!0;else n[e]=!0;else if(r>1)for(var i=0;r>i;i++)n[arguments[i]]=!0;else this.clear();return unregister(n),_chain.unshift({key:"undo",processor:"undo"}),this},this.clear=function(){return _chain.length=0,_keysIndex=Object.create(null),this},this.kill=function(){return this.clear(),delete _instance[_s.id],_g=null,_s=null,this},this.serialize=function(){for(var e=cloneChain(_chain),n=0,r=e.length;r>n;n++)e[n].predicate=e[n].predicate.toString().replace(/\s+/g," ").replace(/"use strict"; /,"");return e},this.load=function(chain){if(chain===undefined)throw new TypeError("Missing argument.");if(!Array.isArray(chain))throw new TypeError('Invalid argument: "chain" is not an array, was '+chain);this.clear();for(var copy=cloneChain(chain),i=0,len=copy.length;len>i;i++){if(copy[i].predicate===undefined)throw new TypeError('Missing filter key: "predicate".');if(copy[i].processor===undefined)throw new TypeError('Missing filter key: "processor".');if(copy[i].key!=undefined&&"string"!=typeof copy[i].key)throw new TypeError('Invalid filter key: "key" is not a string, was '+copy[i].key.toString());if("string"==typeof copy[i].predicate&&eval(" copy[i].predicate = "+copy[i].predicate),"function"!=typeof copy[i].predicate)throw new TypeError('Invalid filter key: "predicate" of key "'+copy[i].key+'" is not a function.');if("string"!=typeof copy[i].processor)throw new TypeError('Invalid filter key: "processor" of key "'+copy[i].key+'" is not a string.');copy[i].key&&(_keysIndex[copy[i].key]=!0)}return _chain=copy,this}}if("undefined"==typeof sigma)throw new Error("sigma is not declared");sigma.utils.pkg("sigma.plugins");var _instance={};sigma.classes.graph.hasMethod("adjacentNodes")||sigma.classes.graph.addMethod("adjacentNodes",function(e){if("number"!=typeof e&&"string"!=typeof e)throw new TypeError('Invalid argument: "id" is not a string or a number, was '+e);var n,r=[];for(n in this.allNeighborsIndex[e])r.push(this.nodesIndex.get(n));return r}),sigma.classes.graph.hasMethod("adjacentEdges")||sigma.classes.graph.addMethod("adjacentEdges",function(e){if("number"!=typeof e&&"string"!=typeof e)throw new TypeError('Invalid argument: "id" is not a string or a number, was '+e);var n,r,i=this.allNeighborsIndex[e],t=[];for(r in i)for(n in i[r])t.push(i[r][n]);return t});var Processors={};Processors.nodes=function(e,n,r){if(e){for(var i=e.nodes(),t=i.length,o=e.edges(),s=o.length;t--;)i[t].hidden=!n.call({graph:e,get:strToObjectRef},i[t],r)||i[t].hidden;for(;s--;)(e.nodes(o[s].source).hidden||e.nodes(o[s].target).hidden)&&(o[s].hidden=!0)}},Processors.edges=function(e,n,r){if(e)for(var i=e.edges(),t=i.length;t--;)i[t].hidden=!n.call({graph:e,get:strToObjectRef},i[t],r)||i[t].hidden},Processors.neighbors=function(e,n){if(e){for(var r=e.nodes(),i=r.length,t=e.edges(),o=t.length,s=e.adjacentNodes(n),a=s.length,c={};a--;)c[s[a].id]=!0;for(;i--;)r[i].id===n||r[i].id in c||(r[i].hidden=!0);for(;o--;)(e.nodes(t[o].source).hidden||e.nodes(t[o].target).hidden)&&(t[o].hidden=!0)}},Processors.undo=function(e){if(e){for(var n=e.nodes(),r=n.length,i=e.edges(),t=i.length;r--;)n[r].hidden=!1;for(;t--;)i[t].hidden=!1}},sigma.plugins.filter=function(e){return _instance[e.id]||(_instance[e.id]=new Filter(e),e.bind("kill",function(){sigma.plugins.killFilter(e)})),_instance[e.id]},sigma.plugins.killFilter=function(e){_instance[e.id]instanceof Filter&&_instance[e.id].kill(),delete _instance[e.id]}}).call(this);
